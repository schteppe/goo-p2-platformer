/* Goo Engine fsmpack 0.10.0
 * Copyright 2014 Goo Technologies AB
 */
(function(window){function f(){
define("goo/fsmpack/statemachine/State",["goo/util/ArrayUtil"],function(e){function t(e){this.uuid=e,this._fsm=null,this.parent=null,this._actions=[],this._machines=[],this._transitions={},this.vars={},this.transitionTarget=null,this.proxy={getTpf:function(){return this._fsm.entity._world.tpf}.bind(this),getTime:function(){return this._fsm.system.time}.bind(this),getState:function(){return this}.bind(this),getFsm:function(){return this._fsm}.bind(this),getOwnerEntity:function(){return this._fsm.entity}.bind(this),send:function(e){e&&typeof e=="string"&&this._transitions[e]&&this.requestTransition(this._transitions[e])}.bind(this),addListener:function(e,t){this._fsm._bus.addListener(e,t)}.bind(this),removeListener:function(e,t){this._fsm._bus.removeListener(e,t)}.bind(this),defineVariable:function(e,t){this.vars[e]=t}.bind(this),removeVariable:function(e){delete this.vars[e]}.bind(this),getVariable:function(e){return this.vars[e]!==undefined?this.vars[e]:this._fsm.getVariable(e)}.bind(this),applyOnVariable:function(e,t){this.vars[e]!==undefined?this.vars[e]=t(this.vars[e]):this._fsm.applyOnVariable(e,t)}.bind(this),getEvalProxy:function(){return this._fsm.system.evalProxy}.bind(this)}}return t.prototype.setRefs=function(e){this._fsm=e;for(var t=0;t<this._machines.length;t++){var n=this._machines[t];n.setRefs(e)}},t.prototype.isCurrentState=function(){return this===this.parent.getCurrentState()},t.prototype.requestTransition=function(e){this.isCurrentState()&&(this.transitionTarget=e)},t.prototype.setTransition=function(e,t){this._transitions[e]=t},t.prototype.clearTransition=function(e){delete this._transitions[e]},t.prototype.update=function(){for(var e=0;e<this._actions.length;e++){this._actions[e].update(this.proxy);if(this.transitionTarget){var t=this.transitionTarget;return this.transitionTarget=null,t}}var n;for(var e=0;e<this._machines.length;e++){var r=this._machines[e];n=r.update();if(n)return n}},t.prototype.reset=function(){for(var e=0;e<this._machines.length;e++)this._machines[e].reset()},t.prototype.kill=function(){for(var e=0;e<this._machines.length;e++)this._machines[e].kill();for(var e=0;e<this._actions.length;e++)this._actions[e].exit(this.proxy)},t.prototype.ready=function(){for(var e=0;e<this._machines.length;e++)this._machines[e].ready();for(var e=0;e<this._actions.length;e++)this._actions[e].ready(this.proxy)},t.prototype.cleanup=function(){for(var e=0;e<this._machines.length;e++)this._machines[e].cleanup();for(var e=0;e<this._actions.length;e++)this._actions[e].cleanup(this.proxy)},t.prototype.enter=function(){for(var e=0;e<this._actions.length;e++)this._actions[e].enter(this.proxy);for(var e=0;e<this._machines.length;e++)this._machines[e].enter()},t.prototype.getAction=function(e){if(!this._actions)return undefined;for(var t=0;t<this._actions.length;t++){var n=this._actions[t];if(e!==undefined&&n.id===e)return n}return undefined},t.prototype.addAction=function(e){if(this._actions[e.id])return;e.onCreate&&e.onCreate(this.proxy),this._actions.push(e)},t.prototype.recursiveRemove=function(){this.removeAllActions();for(var e=0;e<this._machines.length;e++)this._machines[e].recursiveRemove();this._machines=[]},t.prototype.removeAllActions=function(){for(var e=0;e<this._actions.length;e++){var t=this._actions[e];t.onDestroy&&t.onDestroy(this.proxy)}this._actions=[]},t.prototype.removeAction=function(t){t.onDestroy&&t.onDestroy(this.proxy),e.remove(this._actions,t)},t.prototype.addMachine=function(e){var t=this._machines.indexOf(e);t===-1&&(e._fsm=this._fsm,e.parent=this,this._machines.push(e))},t.prototype.removeMachine=function(t){t.recursiveRemove(),e.remove(this._machines,t)},t}),define("goo/fsmpack/statemachine/Machine",[],function(){function e(e){this.name=e,this._fsm=null,this.initialState="entry",this.currentState=null,this.parent=null}return e.prototype.setRefs=function(e){this._fsm=e;var t=Object.keys(this._states);for(var n=0;n<t.length;n++){var r=this._states[t[n]];r.setRefs(e)}},e.prototype.update=function(){if(this.currentState){var e=this.currentState.update();return e&&this.contains(e)&&(this.currentState.kill(),this.setState(this._states[e])),e}},e.prototype.contains=function(e){return!!this._states[e]},e.prototype.setState=function(e){this.currentState=e,this.currentState.reset(),this.currentState.enter()},e.prototype.reset=function(){this.currentState=this._states[this.initialState],this.currentState&&this.currentState.reset()},e.prototype.kill=function(){this.currentState&&this.currentState.kill()},e.prototype.ready=function(){var e=Object.keys(this._states);for(var t=0;t<e.length;t++){var n=this._states[e[t]];n.ready()}},e.prototype.cleanup=function(){var e=Object.keys(this._states);for(var t=0;t<e.length;t++){var n=this._states[e[t]];n.cleanup()}},e.prototype.enter=function(){this.currentState&&this.currentState.enter()},e.prototype.getCurrentState=function(){return this.currentState},e.prototype.addState=function(e){this._states||(this._states={},this.initialState=e.uuid),e.parent=this,e._fsm=this._fsm,this._states[e.uuid]=e},e.prototype.removeFromParent=function(){this.parent&&this.parent.removeMachine(this)},e.prototype.recursiveRemove=function(){var e=Object.keys(this._states);for(var t=0;t<e.length;t++){var n=this._states[e[t]];n.recursiveRemove()}this._states={}},e.prototype.removeState=function(e){if(!this._states[e])return;if(this.initialState===e)throw new Error("Cannot remove initial state");this.currentState===this._states[e]&&this.reset(),delete this._states[e]},e.prototype.setInitialState=function(e){this.initialState=e},e}),define("goo/fsmpack/statemachine/FSMUtil",[],function(){function e(){}function t(e){var t=[],n=Object.keys(e);for(var r=0;r<n.length;r++)t[e[n[r]]]=n[r];return t}e.setParameters=function(e,t){for(var n=0;n<t.length;n++){var r=t[n],i=r.key;typeof e[i]!="undefined"?this[i]=e[i]:this[i]=r["default"]}},e.setTransitions=function(e,t){for(var n=0;n<t.length;n++){var r=t[n],i=r.key;this.transitions=this.transitions||{},this.transitions[i]=e.transitions[i]}},e.getKey=function(t){return e.keys[t]?e.keys[t]:t.charCodeAt(0)},e.keys={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Pause:19,Capslock:20,Esc:27,Space:32,Pageup:33,Pagedown:34,End:35,Home:36,Leftarrow:37,Uparrow:38,Rightarrow:39,Downarrow:40,Insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"0numpad":96,"1numpad":97,"2numpad":98,"3numpad":99,"4numpad":100,"5numpad":101,"6numpad":102,"7numpad":103,"8numpad":104,"9numpad":105,Multiply:106,Plus:107,Minus:109,Dot:110,Slash1:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,Equals:187,Comma:188,Slash:191,Backslash:220},e.keyInverse=[],e.keyInverse=t(e.keys),e.keyForCode=function(t){return e.keyInverse[t]?e.keyInverse[t]:"FSMUtil.keyForCode: key not found for code "+t};var n=function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)};return e.guid=function(){return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()},e.getValue=function(e,t){return typeof e=="number"?e:t.getVariable(e)},e.createComposableTween=function(e,t,n,r,i,s){var o=new window.TWEEN.Tween,u=n;return o.from({v:n}).to({v:r}).onUpdate(function(){e[t]+=this.v-u,u=this.v,s&&s()})},e}),define("goo/fsmpack/statemachine/actions/Action",["goo/fsmpack/statemachine/FSMUtil"],function(e){function t(e,t){this.id=e,this.configure(t||{})}return t.prototype._setup=function(){},t.prototype._run=function(){},t.prototype.configure=function(t){e.setParameters.call(this,t,this.constructor.external.parameters),e.setTransitions.call(this,t,this.constructor.external.transitions)},t.prototype.enter=function(e){this._setup(e),this.everyFrame||this._run(e)},t.prototype.update=function(e){this.everyFrame&&this._run(e)},t.prototype.ready=function(){},t.prototype.cleanup=function(){},t.prototype.exit=function(){},t}),define("goo/fsmpack/statemachine/actions/ArrowsAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments),this.updated=!1,this.keysPressed={},this.eventListener=function(e){var n=t._keys[e.which];n!==undefined&&(this.updated=!0,this.keysPressed[n]=!0)}.bind(this)}return t.prototype=Object.create(e.prototype),t.prototype.configure=function(e){this.everyFrame=!0,this.targets=e.transitions},t._keys={38:"up",37:"left",40:"down",39:"right"},t.external=function(){var e=[];for(var n in t._keys){var r=t._keys[n];e.push({name:"Key "+r.toUpperCase(),key:r,description:"Key '"+r+"' pressed"})}return{key:"Arrow Keys Listener",name:"Arrow Keys",type:"controls",description:"A 4-in-1 key down listener",canTransition:!0,parameters:[],transitions:e}}(),t.prototype._setup=function(){document.addEventListener("keydown",this.eventListener)},t.prototype._run=function(e){if(this.updated){this.updated=!1;for(var t in this.keysPressed){var n=this.targets[t];typeof n=="string"&&e.send(n)}this.keysPressed=[]}},t.prototype.exit=function(){document.removeEventListener("keydown",this.eventListener)},t}),define("goo/fsmpack/statemachine/actions/MouseUpAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(e){this.button=e.button,this.updated=!0}.bind(this)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Mouse Up",type:"controls",description:"Listens for a mouse button release and performs a transition",canTransition:!0,parameters:[],transitions:[{key:"mouseLeftUp",name:"Left mouse up",description:"State to transition to when the left mouse button is released"},{key:"middleMouseUp",name:"Middle mouse up",description:"State to transition to when the middle mouse button is released"},{key:"rightMouseUp",name:"Right mouse up",description:"State to transition to when the right mouse button is released"}]},t.prototype._setup=function(){document.addEventListener("mouseup",this.eventListener)},t.prototype._run=function(e){this.updated&&(this.updated=!1,e.send([this.transitions.mouseLeftUp,this.transitions.middleMouseUp,this.transitions.rightMouseUp][this.button]))},t.prototype.exit=function(){document.removeEventListener("mouseup",this.eventListener)},t}),define("goo/fsmpack/statemachine/actions/MouseDownAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(e){this.button=e.button,this.updated=!0}.bind(this)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Mouse Down",type:"controls",description:"Listens for a mouse button press and performs a transition",canTransition:!0,parameters:[],transitions:[{key:"mouseLeftDown",name:"Left mouse down",description:"State to transition to when the left mouse button is pressed"},{key:"middleMouseDown",name:"Middle mouse down",description:"State to transition to when the middle mouse button is pressed"},{key:"rightMouseDown",name:"Right mouse down",description:"State to transition to when the right mouse button is pressed"}]},t.prototype._setup=function(){document.addEventListener("mousedown",this.eventListener)},t.prototype._run=function(e){this.updated&&(this.updated=!1,e.send([this.transitions.mouseLeftDown,this.transitions.middleMouseDown,this.transitions.rightMouseDown][this.button]))},t.prototype.exit=function(){document.removeEventListener("mousedown",this.eventListener)},t}),define("goo/fsmpack/statemachine/actions/MouseMoveAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(){this.updated=!0}.bind(this)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Mouse Move",type:"controls",description:"Listens for mouse movement and performs a transition",canTransition:!0,parameters:[],transitions:[{key:"mousemove",name:"Mouse move",description:"State to transition to on mouse movement"}]},t.prototype._setup=function(){document.addEventListener("mousemove",this.eventListener)},t.prototype._run=function(e){this.updated&&(this.updated=!1,e.send(this.transitions.mousemove))},t.prototype.exit=function(){document.removeEventListener("mousemove",this.eventListener)},t}),define("goo/fsmpack/statemachine/actions/KeyUpAction",["goo/fsmpack/statemachine/actions/Action","goo/fsmpack/statemachine/FSMUtil"],function(e,t){function n(){e.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(e){if(!this.key||e.which===+this.key)this.updated=!0}.bind(this)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.external={name:"Key Up",type:"controls",description:"Listens for a key release and performs a transition",canTransition:!0,parameters:[{name:"Key",key:"key",type:"key",description:"Key to listen for","default":"A"}],transitions:[{key:"keyup",name:"Key up",description:"State to transition to when the key is released"}]},n.prototype.configure=function(e){this.key=e.key?t.getKey(e.key):null,this.transitions={keyup:e.transitions.keyup}},n.prototype._setup=function(){document.addEventListener("keyup",this.eventListener)},n.prototype._run=function(e){this.updated&&(this.updated=!1,e.send(this.transitions.keyup))},n.prototype.exit=function(){document.removeEventListener("keyup",this.eventListener)},n}),define("goo/fsmpack/statemachine/actions/KeyDownAction",["goo/fsmpack/statemachine/actions/Action","goo/fsmpack/statemachine/FSMUtil"],function(e,t){function n(){e.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(e){this.key&&e.which===+this.key&&(this.updated=!0)}.bind(this)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.external={name:"Key Down",type:"controls",description:"Listens for a key press and performs a transition",canTransition:!0,parameters:[{name:"Key",key:"key",type:"key",description:"Key to listen for","default":"A"}],transitions:[{key:"keydown",name:"Key down",description:"State to transition to when the key is pressed"}]},n.prototype.configure=function(e){this.key=e.key?t.getKey(e.key):null,this.transitions={keydown:e.transitions.keydown}},n.prototype._setup=function(){document.addEventListener("keydown",this.eventListener)},n.prototype._run=function(e){this.updated&&(this.updated=!1,e.send(this.transitions.keydown))},n.prototype.exit=function(){document.removeEventListener("keydown",this.eventListener)},n}),define("goo/fsmpack/statemachine/actions/KeyPressedAction",["goo/fsmpack/statemachine/actions/Action","goo/fsmpack/statemachine/FSMUtil"],function(e,t){function n(){e.apply(this,arguments),this.everyFrame=!0,this.keyIsDown=!1,this.eventListenerDown=function(e){e.which===+this.key&&(this.keyIsDown=!0)}.bind(this),this.eventListenerUp=function(e){e.which===+this.key&&(document.removeEventListener("keydown",this.eventListenerUp),this.keyIsDown=!1)}.bind(this)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.external={name:"Key Pressed",type:"controls",description:"Listens for a key press and performs a transition. Works over transition boundaries.",canTransition:!0,parameters:[{name:"Key",key:"key",type:"key",description:"Key to listen for"}],transitions:[{key:"keydown",name:"Key pressed",description:"State to transition to when the key is pressed"}]},n.prototype.configure=function(e){this.key=e.key?t.getKey(e.key):null,this.transitions={keydown:e.transitions.keydown}},n.prototype._setup=function(){document.addEventListener("keydown",this.eventListenerDown),document.addEventListener("keyup",this.eventListenerUp)},n.prototype._run=function(e){this.keyIsDown&&e.send(this.transitions.keydown)},n.prototype.exit=function(){document.removeEventListener("keydown",this.eventListenerDown)},n}),define("goo/fsmpack/statemachine/actions/PickAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(e){e.entity===this.ownerEntity&&(this.updated=!0)}.bind(this)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Pick",type:"controls",description:"Listens for a picking event and performs a transition",canTransition:!0,parameters:[],transitions:[{key:"pick",name:"Pick",description:"State to transition to when entity is picked"}]},t.prototype._setup=function(e){this.ownerEntity=e.getOwnerEntity(),this.goo=this.ownerEntity._world.gooRunner,this.goo.addEventListener("click",this.eventListener)},t.prototype._run=function(e){this.updated&&(this.updated=!1,e.send(this.transitions.pick))},t.prototype.exit=function(){this.goo&&this.goo.removeEventListener("click",this.eventListener)},t}),define("goo/fsmpack/statemachine/actions/PickAndExitAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments),this.eventListener=function(e){var t=this.ownerEntity.getComponent("HtmlComponent"),n=t&&t.domElement.contains(e.target);if(n){this.handleExit();return}if(e.target!==this.canvasElement)return;var r=this.goo.pickSync(e.offsetX,e.offsetY);if(r.id===-1)return;var i=this.goo.world.entityManager.getEntityByIndex(r.id),s=[];this.ownerEntity.traverse(s.push.bind(s));if(s.indexOf(i)===-1)return;this.handleExit()}.bind(this)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Pick and Exit",type:"controls",description:"Listens for a picking event and opens a new browser window",canTransition:!0,parameters:[{name:"URL",key:"url",type:"string",description:"URL to open","default":"http://www.gootechnologies.com"},{name:"Exit name",key:"exitName",type:"string",description:"Name of the exit, used to track this exit in Ads.","default":"clickEntityExit"}],transitions:[]},t.prototype._setup=function(e){this.ownerEntity=e.getOwnerEntity(),this.goo=this.ownerEntity._world.gooRunner,this.canvasElement=this.goo.renderer.domElement,this.domElement=this.canvasElement.parentNode,this.domElement.addEventListener("click",this.eventListener,!1)},t.prototype._run=function(){},t.prototype.handleExit=function(){var e=window.gooHandleExit||function(e){window.open(e,"_blank")};e(this.url,this.exitName)},t.prototype.exit=function(){this.domElement&&this.domElement.removeEventListener("click",this.eventListener)},t}),define("goo/fsmpack/statemachine/actions/WASDAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments),this.updated=!1,this.keysPressed={},this.eventListener=function(e){var n=t._keys[e.which];n!==undefined&&(this.updated=!0,this.keysPressed[n]=!0)}.bind(this)}return t.prototype=Object.create(e.prototype),t.prototype.configure=function(e){this.everyFrame=!0,this.targets=e.transitions},t._keys={87:"w",65:"a",83:"s",68:"d"},t.external=function(){var e=[];for(var n in t._keys){var r=t._keys[n];e.push({key:r,name:"Key "+r.toUpperCase(),description:"Key '"+r+"' pressed"})}return{key:"WASD Keys Listener",name:"WASD Keys",type:"controls",description:"A 4-in-1 key down listener",canTransition:!0,parameters:[],transitions:e}}(),t.prototype._setup=function(){document.addEventListener("keydown",this.eventListener)},t.prototype._run=function(e){if(this.updated){this.updated=!1;for(var t in this.keysPressed){var n=this.targets[t];typeof n=="string"&&e.send(n)}this.keysPressed=[]}},t.prototype.exit=function(){document.removeEventListener("keydown",this.eventListener)},t}),define("goo/fsmpack/statemachine/actions/MoveAction",["goo/fsmpack/statemachine/actions/Action","goo/math/Vector3"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.external={name:"Move",type:"animation",description:"Moves the entity",parameters:[{name:"Translation",key:"translation",type:"position",description:"Move","default":[0,0,0]},{name:"Oriented",key:"oriented",type:"boolean",description:"If true translate with rotation","default":!0},{name:"Relative",key:"relative",type:"boolean",description:"If true add to current translation","default":!0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},n.prototype._setup=function(e){var n=e.getOwnerEntity(),r=n.transformComponent.transform;this.forward=(new t).seta(this.translation);var i=r.rotation;i.applyPost(this.forward)},n.prototype._run=function(e){var n=e.getOwnerEntity(),r=n.transformComponent.transform,i=r.translation;if(this.oriented)if(this.relative){var s=(new t).seta(this.translation),o=r.rotation;o.applyPost(s),this.everyFrame?(s.scale(e.getTpf()*10),i.add(s)):i.add(s)}else i.set(this.forward);else if(this.relative)if(this.everyFrame){var u=e.getTpf()*10;i.data[0]+=this.translation[0]*u,i.data[1]+=this.translation[1]*u,i.data[2]+=this.translation[2]*u}else i.add(this.translation);else i.set(this.translation);n.transformComponent.setUpdated()},n}),define("goo/fsmpack/statemachine/actions/RotateAction",["goo/fsmpack/statemachine/actions/Action","goo/math/MathUtils"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.external={name:"Rotate",type:"animation",description:"Rotates the entity with the set angles.",parameters:[{name:"Rotation",key:"rotation",type:"rotation",description:"Rotate","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add to current rotation","default":!0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},n.prototype._run=function(e){var n=e.getOwnerEntity(),r=n.transformComponent.transform;if(this.relative)if(this.everyFrame){var i=e.getTpf();r.rotation.rotateX(this.rotation[0]*t.DEG_TO_RAD*i),r.rotation.rotateY(this.rotation[1]*t.DEG_TO_RAD*i),r.rotation.rotateZ(this.rotation[2]*t.DEG_TO_RAD*i)}else r.rotation.rotateX(this.rotation[0]*t.DEG_TO_RAD),r.rotation.rotateY(this.rotation[1]*t.DEG_TO_RAD),r.rotation.rotateZ(this.rotation[2]*t.DEG_TO_RAD);else if(this.everyFrame){var i=e.getTpf();r.setRotationXYZ(this.rotation[0]*t.DEG_TO_RAD*i,this.rotation[1]*t.DEG_TO_RAD*i,this.rotation[2]*t.DEG_TO_RAD*i)}else r.setRotationXYZ(this.rotation[0]*t.DEG_TO_RAD,this.rotation[1]*t.DEG_TO_RAD,this.rotation[2]*t.DEG_TO_RAD);n.transformComponent.setUpdated()},n}),define("goo/fsmpack/statemachine/actions/ScaleAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Scale",type:"animation",description:"Scales the entity",parameters:[{name:"Scale",key:"scale",type:"position",description:"Move","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add/multiply the current scaling","default":!0},{name:"Multiply",key:"multiply",type:"boolean",description:"If true multiply, otherwise add","default":!1},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},t.prototype._run=function(e){var t=e.getOwnerEntity(),n=t.transformComponent.transform;if(this.relative)if(this.multiply)if(this.everyFrame){var r=e.getTpf()*10;n.scale.data[0]*=this.scale[0]*r,n.scale.data[1]*=this.scale[1]*r,n.scale.data[2]*=this.scale[2]*r}else n.scale.mul(this.scale);else if(this.everyFrame){var r=e.getTpf()*10;n.scale.data[0]+=this.scale[0]*r,n.scale.data[1]+=this.scale[1]*r,n.scale.data[2]+=this.scale[2]*r}else n.scale.add(this.scale);else n.scale.set(this.scale);t.transformComponent.setUpdated()},t}),define("goo/fsmpack/statemachine/actions/LookAtAction",["goo/fsmpack/statemachine/actions/Action","goo/math/Vector3"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.external={name:"Look At",type:"animation",description:"Reorients an entity so that it's facing a specific point",parameters:[{name:"Look at position",key:"lookAt",type:"position",description:"Position to look at","default":[0,0,0]},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},n.prototype._run=function(e){var n=e.getOwnerEntity(),r=n.transformComponent;r.transform.lookAt(new t(this.lookAt),t.UNIT_Y),r.setUpdated()},n}),define("goo/fsmpack/statemachine/actions/TweenMoveAction",["goo/fsmpack/statemachine/actions/Action","goo/math/Vector3"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.external={name:"Tween Move",type:"animation",description:"Transition to the set location.",canTransition:!0,parameters:[{name:"Translation",key:"to",type:"position",description:"Move","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add, otherwise set","default":!0},{name:"Time (ms)",key:"time",type:"number",description:"Time it takes for this movement to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the movement completes"}]},n.prototype.configure=function(e){this.to=e.to,this.relative=e.relative,this.time=e.time,e.easing1==="Linear"?this.easing=window.TWEEN.Easing.Linear.None:this.easing=window.TWEEN.Easing[e.easing1][e.easing2],this.eventToEmit={channel:e.transitions.complete}},n.prototype._setup=function(){this.tween=new window.TWEEN.Tween},n.prototype.cleanup=function(){this.tween&&this.tween.stop()},n.prototype._run=function(e){var n=e.getOwnerEntity(),r=n.transformComponent,i=r.transform.translation,s=(new t).copy(i),o=n._world.time*1e3,u={x:s.x,y:s.y,z:s.z},a,f={x:u.x,y:u.y,z:u.z};if(this.relative){var l=t.add(s,this.to);a={x:l.x,y:l.y,z:l.z},this.tween.from(u).to(a,+this.time).easing(this.easing).onUpdate(function(){i.data[0]+=this.x-f.x,i.data[1]+=this.y-f.y,i.data[2]+=this.z-f.z,f.x=this.x,f.y=this.y,f.z=this.z,r.setUpdated()}).onComplete(function(){e.send(this.eventToEmit.channel)}.bind(this)).start(o)}else a={x:this.to[0],y:this.to[1],z:this.to[2]},this.tween.from(u).to(a,+this.time).easing(this.easing).onUpdate(function(){i.data[0]+=this.x-f.x,i.data[1]+=this.y-f.y,i.data[2]+=this.z-f.z,f.x=this.x,f.y=this.y,f.z=this.z,r.setUpdated()}).onComplete(function(){e.send(this.eventToEmit.channel)}.bind(this)).start(o)},n}),define("goo/fsmpack/statemachine/actions/TweenRotationAction",["goo/fsmpack/statemachine/actions/Action","goo/math/Quaternion","goo/math/Matrix3x3","goo/math/MathUtils"],function(e,t,n,r){function i(){e.apply(this,arguments)}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.external={key:"Tween Rotation",name:"Tween Rotate",type:"animation",description:"Transition to the set rotation, in angles.",canTransition:!0,parameters:[{name:"Rotation",key:"to",type:"rotation",description:"Rotation","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add, otherwise set","default":!0},{name:"Time (ms)",key:"time",type:"number",description:"Time it takes for this movement to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the rotation completes"}]},i.prototype.configure=function(e){this.to=e.to,this.relative=e.relative,this.time=e.time,e.easing1==="Linear"?this.easing=window.TWEEN.Easing.Linear.None:this.easing=window.TWEEN.Easing[e.easing1][e.easing2],this.eventToEmit={channel:e.transitions.complete}},i.prototype._setup=function(){this.tween=new window.TWEEN.Tween},i.prototype.cleanup=function(){this.tween&&this.tween.stop()},i.prototype._run=function(e){var i=e.getOwnerEntity(),s=i.transformComponent,o=s.transform.rotation,u=(new t).fromRotationMatrix(o),a=(new t).fromRotationMatrix((new n).fromAngles(this.to[0]*r.DEG_TO_RAD,this.to[1]*r.DEG_TO_RAD,this.to[2]*r.DEG_TO_RAD)),f=new t,l=i._world.time*1e3;this.relative&&t.mul(u,a,a),this.tween.from({t:0}).to({t:1},+this.time).easing(this.easing).onUpdate(function(){t.slerp(u,a,this.t,f),o.copyQuaternion(f),s.setUpdated()}).onComplete(function(){e.send(this.eventToEmit.channel)}.bind(this)).start(l)},i}),define("goo/fsmpack/statemachine/actions/TweenScaleAction",["goo/fsmpack/statemachine/actions/Action","goo/math/Vector3"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.external={name:"Tween Scale",type:"animation",description:"Transition to the set scale.",canTransition:!0,parameters:[{name:"Scale",key:"to",type:"position",description:"Scale","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add, otherwise set","default":!0},{name:"Time (ms)",key:"time",type:"number",description:"Time it takes for this movement to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the scaling completes"}]},n.prototype.configure=function(e){this.to=e.to,this.relative=e.relative,this.time=e.time,e.easing1==="Linear"?this.easing=window.TWEEN.Easing.Linear.None:this.easing=window.TWEEN.Easing[e.easing1][e.easing2],this.eventToEmit={channel:e.transitions.complete}},n.prototype._setup=function(){this.tween=new window.TWEEN.Tween},n.prototype.cleanup=function(){this.tween&&this.tween.stop()},n.prototype._run=function(e){var n=e.getOwnerEntity(),r=n.transformComponent,i=r.transform.scale,s=(new t).copy(i),o={x:s.x,y:s.y,z:s.z},u,a=n._world.time*1e3;if(this.relative){var f=t.add(s,this.to);u={x:f.x,y:f.y,z:f.z},this.tween.from(o).to(u,+this.time).easing(this.easing).onUpdate(function(){i.setd(this.x,this.y,this.z),r.setUpdated()}).onComplete(function(){e.send(this.eventToEmit.channel)}.bind(this)).start(a)}else u={x:this.to[0],y:this.to[1],z:this.to[2]},this.tween.from(o).to(u,+this.time).easing(this.easing).onUpdate(function(){i.setd(this.x,this.y,this.z),r.setUpdated()}).onComplete(function(){e.send(this.eventToEmit.channel)}.bind(this)).start(a)},n}),define("goo/fsmpack/statemachine/actions/TweenLookAtAction",["goo/fsmpack/statemachine/actions/Action","goo/math/Vector3"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.external={name:"Tween Look At",type:"animation",description:"Transition the entity's rotation to face the set position.",canTransition:!0,parameters:[{name:"Position",key:"to",type:"position",description:"Look at point","default":[0,0,0]},{name:"Time (ms)",key:"time",type:"number",description:"Time it takes for this movement to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On completion",description:"State to transition to when the transition completes"}]},n.prototype.configure=function(e){this.to=e.to,this.relative=e.relative,this.time=e.time,e.easing1==="Linear"?this.easing=window.TWEEN.Easing.Linear.None:this.easing=window.TWEEN.Easing[e.easing1][e.easing2],this.eventToEmit={channel:e.transitions.complete}},n.prototype._setup=function(){this.tween=new window.TWEEN.Tween},n.prototype.cleanup=function(){this.tween&&this.tween.stop()},n.prototype._run=function(e){var n=e.getOwnerEntity(),r=n.transformComponent,i=r.transform,s=t.distance(new t(this.to),i.translation),o=n._world.time*1e3,u=new t(0,0,1),a=i.rotation;a.applyPost(u),u.scale(s);var f={x:u.x,y:u.y,z:u.z},l={x:this.to[0],y:this.to[1],z:this.to[2]},c=new t;this.tween.from(f).to(l,+this.time).easing(this.easing).onUpdate(function(){c.data[0]=this.x,c.data[1]=this.y,c.data[2]=this.z,i.lookAt(c,t.UNIT_Y),r.setUpdated()}).onComplete(function(){e.send(this.eventToEmit.channel)}.bind(this)).start(o)},n}),define("goo/fsmpack/statemachine/actions/ShakeAction",["goo/fsmpack/statemachine/actions/Action","goo/math/Vector3"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.external={name:"Shake",type:"animation",description:"Shakes the entity",canTransition:!0,parameters:[{name:"Start level",key:"startLevel",type:"float",description:"Shake amount at start","default":0},{name:"End level",key:"endLevel",type:"float",description:"Shake amount at the end","default":10},{name:"Time (ms)",key:"time",type:"float",description:"Shake time amount","default":1e3},{name:"Speed",key:"speed",type:"dropdown",description:"Speed of shaking","default":"Fast",options:["Fast","Medium","Slow"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the shake completes"}]},n.prototype.configure=function(e){this.startLevel=e.startLevel,this.endLevel=e.endLevel,this.time=e.time,this.speed={Fast:1,Medium:2,Slow:4}[e.speed],this.easing=window.TWEEN.Easing.Quadratic.InOut,this.eventToEmit={channel:e.transitions.complete}},n.prototype._setup=function(){this.tween=new window.TWEEN.Tween},n.prototype.cleanup=function(){this.tween&&this.tween.stop()},n.prototype._run=function(e){var n=e.getOwnerEntity(),r=n.transformComponent,i=r.transform.translation,s=n._world.time*1e3,o=new t,u=new t,a=new t,f=this,l=0;this.tween.from({level:+this.startLevel}).to({level:+this.endLevel},+this.time).easing(this.easing).onUpdate(function(){l++,l>f.speed&&(l=0,u.setd(-o.data[0]+(Math.random()-.5)*this.level*2,-o.data[1]+(Math.random()-.5)*this.level*2,-o.data[2]+(Math.random()-.5)*this.level*2)),a.setd(a.data[0]*.98+u.data[0]*.1,a.data[1]*.98+u.data[1]*.1,a.data[2]*.98+u.data[2]*.1),i.add(a).sub(o),o.copy(a),r.setUpdated()}).onComplete(function(){i.sub(o),r.setUpdated(),e.send(this.eventToEmit.channel)}.bind(this)).start(s)},n}),define("goo/fsmpack/statemachine/actions/PauseAnimationAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Pause Animation",type:"animation",description:"Pauses skeleton animations",parameters:[{name:"On all",key:"onAll",type:"boolean",description:"Pause animation on all entities or just one","default":!1}],transitions:[]},t.prototype._run=function(e){if(this.onAll){var t=e.getWorld(),n=t.getSystem("AnimationSystem");n.pause()}else{var r=e.getOwnerEntity();r.animationComponent&&r.animationComponent.pause()}},t}),define("goo/fsmpack/statemachine/actions/ResumeAnimationAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Resume Animation",type:"animation",description:"Continues playing a skeleton animation",parameters:[{name:"On all",key:"onAll",type:"boolean",description:"Resume animation on all entities or just one","default":!1}],transitions:[]},t.prototype._run=function(e){if(this.onAll){var t=e.getWorld(),n=t.getSystem("AnimationSystem");n.resume()}else{var r=e.getOwnerEntity();r.animationComponent&&r.animationComponent.resume()}},t}),define("goo/fsmpack/statemachine/actions/SetAnimationAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments),this.everyFrame=!1}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Set Animation",type:"animation",description:"Transitions between skeleton animations",parameters:[{name:"Animation",key:"animation",type:"animstate"}],transitions:[]},t.prototype._run=function(e){var t=e.getOwnerEntity();typeof this.animation=="string"&&t.animationComponent&&t.animationComponent.transitionTo(this.animation,!0)},t}),define("goo/fsmpack/statemachine/actions/WaitAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments),this.everyFrame=!0,this.currentTime=0,this.totalWait=0}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Wait",type:"animation",description:"Performs a transition after a specified amount of time. A random time can be set, this will add between 0 and the set random time to the specified wait time.",canTransition:!0,parameters:[{name:"Time (ms)",key:"waitTime",type:"number",description:"Base time in milliseconds before transition fires","default":5e3},{name:"Random (ms)",key:"randomTime",type:"number",description:"A random number of milliseconds (between 0 and this value) will be added to the base wait time","default":0}],transitions:[{key:"timeUp",name:"Time up",description:"State to transition to when time up"}]},t.prototype._setup=function(){this.currentTime=0,this.totalWait=parseFloat(this.waitTime)+Math.random()*parseFloat(this.randomTime)},t.prototype._run=function(e){this.currentTime+=e.getTpf()*1e3,this.currentTime>=this.totalWait&&e.send(this.transitions.timeUp)},t}),define("goo/fsmpack/statemachine/actions/TransitionAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Transition",type:"transitions",description:"Performs a transition",canTransition:!0,parameters:[],transitions:[{key:"transition",name:"To",description:"State to transition to"}]},t.prototype._run=function(e){e.send(this.transitions.transition)},t}),define("goo/fsmpack/statemachine/actions/RandomTransitionAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Random Transition",type:"transitions",description:"Performs a random transition",canTransition:!0,parameters:[{name:"Skewness",key:"skewness",type:"float",control:"slider",min:0,max:1,description:"Determines the chance that the first destination is picked over the second","default":1}],transitions:[{key:"transition1",name:"Destination 1",description:"First choice"},{key:"transition2",name:"Destination 2",description:"Second choice"}]},t.prototype._run=function(e){Math.random()<+this.skewness?e.send(this.transitions.transition1):e.send(this.transitions.transition2)},t}),define("goo/fsmpack/statemachine/actions/EmitAction",["goo/fsmpack/statemachine/actions/Action","goo/entities/SystemBus"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.external={key:"Emit message",name:"Emit Message",type:"transitions",description:"Emits a message on the bus",parameters:[{name:"Channel",key:"channel",type:"string",description:"Channel to transmit on","default":""}],transitions:[]},n.prototype._run=function(){t.emit(this.channel,this.data)},n}),define("goo/fsmpack/statemachine/actions/TransitionOnMessageAction",["goo/fsmpack/statemachine/actions/Action","goo/entities/SystemBus"],function(e,t){function n(){e.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(){this.updated=!0}.bind(this)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.external={key:"Transition on Message",name:"Listen",type:"transitions",description:"Performs a transition on receiving a message",canTransition:!0,parameters:[{name:"Message channel",key:"channel",type:"string",description:"Channel to listen to","default":""}],transitions:[{key:"transition",name:"To",description:"State to transition to"}]},n.prototype._setup=function(){t.addListener(this.channel,this.eventListener,!1)},n.prototype._run=function(e){this.updated&&(this.updated=!1,e.send(this.transitions.transition))},n.prototype.exit=function(){t.removeListener(this.channel,this.eventListener)},n}),define("goo/fsmpack/statemachine/actions/EvalAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments),this.expressionFunction=null}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Eval",description:"Evaluates a JS expression",parameters:[{name:"expression",key:"expression",type:"string",description:"JavaScript expression to evaluate","default":""}],transitions:[]},t.prototype._setup=function(){this.expressionFunction=new Function("goo",this.expression)},t.prototype._run=function(e){if(this.expressionFunction)try{this.expressionFunction(e.getEvalProxy())}catch(t){console.warn("Eval code error: "+t.message)}},t}),define("goo/fsmpack/statemachine/actions/HideAction",["goo/fsmpack/statemachine/actions/Action","goo/entities/EntityUtils"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.external={name:"Hide",type:"display",description:"Hides an entity and its children",parameters:[],transitions:[]},n.prototype._run=function(e){var n=e.getOwnerEntity();t.hide(n)},n}),define("goo/fsmpack/statemachine/actions/ShowAction",["goo/fsmpack/statemachine/actions/Action","goo/entities/EntityUtils"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.external={name:"Show",type:"display",description:"Makes an entity visible",parameters:[],transitions:[]},n.prototype._run=function(e){var n=e.getOwnerEntity();t.show(n)},n}),define("goo/fsmpack/statemachine/actions/RemoveAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Remove",type:"display",description:"Removes the entity from the world",parameters:[{name:"Recursive",key:"recursive",type:"boolean",description:"Remove children too","default":!1}],transitions:[]},t.prototype._run=function(e){var t=e.getOwnerEntity();t.removeFromWorld(this.recursive)},t}),define("goo/fsmpack/statemachine/actions/AddLightAction",["goo/fsmpack/statemachine/actions/Action","goo/entities/components/LightComponent","goo/renderer/light/PointLight"],function(e,t,n){function r(){e.apply(this,arguments)}return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.external={name:"Add Light",description:"Adds a light on the entity",type:"light",parameters:[{name:"Color",key:"color",type:"color",description:"Color of the light","default":[1,1,1]},{name:"Range",key:"range",type:"int",control:"slider",min:0,max:5e3,description:"Range of the light","default":200}],transitions:[]},r.prototype._run=function(e){var r=new n;r.range=+this.range,r.color.setd(this.color[0],this.color[1],this.color[2]);var i=e.getOwnerEntity();i.setComponent(new t(r))},r.prototype.cleanup=function(e){var t=e.getOwnerEntity();t.hasComponent("LightComponent")&&t.clearComponent("LightComponent")},r}),define("goo/fsmpack/statemachine/actions/RemoveLightAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Remove Light",type:"light",description:"Removes the light attached to the entity",parameters:[],transitions:[]},t.prototype._run=function(e){var t=e.getOwnerEntity();t.hasComponent("LightComponent")&&t.clearComponent("LightComponent")},t}),define("goo/fsmpack/statemachine/actions/TweenLightColorAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={key:"Tween Light Color",name:"Tween Light",type:"light",description:"Tweens the color of the light",parameters:[{name:"Color",key:"to",type:"color",description:"Color of the light","default":[1,1,1]},{name:"Time (ms)",key:"time",type:"number",description:"Time it takes for the transition to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the transition completes"}]},t.prototype.configure=function(e){this.to=e.to,this.time=e.time,e.easing1==="Linear"?this.easing=window.TWEEN.Easing.Linear.None:this.easing=window.TWEEN.Easing[e.easing1][e.easing2],this.eventToEmit={channel:e.transitions.complete}},t.prototype._setup=function(){this.tween=new window.TWEEN.Tween},t.prototype.cleanup=function(){this.tween&&this.tween.stop()},t.prototype._run=function(e){var t=e.getOwnerEntity();if(t.lightComponent){var n=t.lightComponent,r=n.light.color,i=t._world.time*1e3,s={x:r.x,y:r.y,z:r.z},o={x:this.to[0],y:this.to[1],z:this.to[2]},u={x:s.x,y:s.y,z:s.z};this.tween.from(s).to(o,+this.time).easing(this.easing).onUpdate(function(){r.data[0]+=this.x-u.x,r.data[1]+=this.y-u.y,r.data[2]+=this.z-u.z,u.x=this.x,u.y=this.y,u.z=this.z}).onComplete(function(){e.send(this.eventToEmit.channel)}.bind(this)).start(i)}},t}),define("goo/fsmpack/statemachine/actions/SetClearColorAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={key:"Set Clear Color",name:"Background Color",description:"Sets the clear color",parameters:[{name:"Color",key:"color",type:"color",description:"Color","default":[1,1,1]}],transitions:[]},t.prototype._run=function(e){var t=e.getOwnerEntity(),n=t._world.gooRunner;n.renderer.setClearColor(this.color[0],this.color[1],this.color[2],1)},t}),define("goo/fsmpack/statemachine/actions/SwitchCameraAction",["goo/fsmpack/statemachine/actions/Action","goo/entities/SystemBus","goo/renderer/Renderer"],function(e,t,n){function r(){e.apply(this,arguments),this._camera=null}return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.external={name:"Switch Camera",type:"camera",description:"Switches between cameras",parameters:[{name:"Camera",key:"cameraEntityRef",type:"cameraEntity",description:"Camera to switch to","default":null}],transitions:[]},r.prototype.ready=function(){this._camera=n.mainCamera},r.prototype._run=function(e){var n=e.getOwnerEntity()._world,r=n.entityManager.getEntityById(this.cameraEntityRef);r&&r.cameraComponent&&t.emit("goo.setCurrentCamera",{camera:r.cameraComponent.camera,entity:r})},r.prototype.cleanup=function(){},r}),define("goo/fsmpack/statemachine/actions/InFrustumAction",["goo/fsmpack/statemachine/actions/Action","goo/renderer/Camera","goo/renderer/bounds/BoundingSphere"],function(e,t,n){function r(){e.apply(this,arguments)}return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.external={key:"In Frustum",name:"In View",type:"camera",description:"Performs a transition based on whether the entity is in a camera's frustum or not",canTransition:!0,parameters:[{name:"Current camera",key:"current",type:"boolean",description:"Check this to always use the current camera","default":!0},{name:"Camera",key:"cameraEntityRef",type:"cameraEntity",description:"Other camera; Will be ignored if the previous option is checked","default":null},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[{key:"inside",name:"Inside",description:"State to transition to if entity is in the frustum"},{key:"outside",name:"Outside",description:"State to transition to if entity is outside the frustum"}]},r.prototype._setup=function(e){if(!this.current){var t=e.getOwnerEntity()._world,n=t.entityManager.getEntityById(this.cameraEntityRef);this.camera=n.cameraComponent.camera}},r.prototype._run=function(e){var r=e.getOwnerEntity();if(this.current)r.isVisible?e.send(this.transitions.inside):e.send(this.transitions.outside);else{var i=r.meshRendererComponent?r.meshRendererComponent.worldBound:new n(r.transformComponent.worldTransform.translation,.001);this.camera.contains(i)===t.Outside?e.send(this.transitions.outside):e.send(this.transitions.inside)}},r}),define("goo/fsmpack/statemachine/actions/DollyZoomAction",["goo/fsmpack/statemachine/actions/Action","goo/math/Vector3"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.external={name:"Dolly Zoom",type:"camera",description:"Performs dolly zoom",parameters:[{name:"Forward",key:"forward",type:"number",description:"Number of units to move towards the focus point; Enter negative values to move away","default":100},{name:"Focus point",key:"lookAt",type:"position",description:"Point to focus on while transitioning","default":[0,0,0]},{name:"Time (ms)",key:"time",type:"number",description:"Time","default":1e4},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the transition completes"}]},n.prototype.configure=function(e){this.forward=e.forward,this.lookAt=e.lookAt,this.time=e.time,e.easing1==="Linear"?this.easing=window.TWEEN.Easing.Linear.None:this.easing=window.TWEEN.Easing[e.easing1][e.easing2],this.eventToEmit={channel:e.transitions.complete}},n.prototype._setup=function(e){this.tween=new window.TWEEN.Tween;var n=e.getOwnerEntity();if(n.cameraComponent&&n.cameraComponent.camera){var r=n.cameraComponent.camera;this.initialDistance=(new t(this.lookAt)).distance(r.translation),this.eyeTargetScale=Math.tan(r.fov*(Math.PI/180)/2)*this.initialDistance}else this.eyeTargetScale=null},n.prototype.cleanup=function(){this.tween&&this.tween.stop()},n.prototype._run=function(e){if(this.eyeTargetScale){var n=e.getOwnerEntity(),r=n.transformComponent,i=r.transform.translation,s=(new t).copy(i),o=n.cameraComponent.camera,u=n._world.time*1e3,a=(new t(this.lookAt)).sub(s).normalize().scale(this.forward).add(s),f={x:s.x,y:s.y,z:s.z,d:this.initialDistance},l={x:a.x,y:a.y,z:a.z,d:+this.initialDistance- +this.forward},c={x:f.x,y:f.y,z:f.z},h=this;this.tween.from(f).to(l,+this.time).easing(this.easing).onUpdate(function(){i.data[0]+=this.x-c.x,i.data[1]+=this.y-c.y,i.data[2]+=this.z-c.z,c.x=this.x,c.y=this.y,c.z=this.z,r.setUpdated();var e=180/Math.PI*2*Math.atan(h.eyeTargetScale/this.d);o.setFrustumPerspective(e)}).onComplete(function(){e.send(this.eventToEmit.channel)}.bind(this)).start(u)}},n}),define("goo/fsmpack/statemachine/actions/InBoxAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}function n(e,t,n){var r=!1,i=function(e,t,n){if(t>n){if(e<t&&e>n)return!0}else if(n>t){if(e<n&&e>t)return!0}else if(e===n)return!0;return!1},s=i(e[0],t[0],n[0]),o=i(e[1],t[1],n[1]),u=i(e[2],t[2],n[2]);return s&&o&&u&&(r=!0),r}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"In Box",type:"collision",description:"Performs a transition based on whether an entity is inside a user defined box volume or not.The volume is defined by setting two points which, when connected, form a diagonal through the box volume.",canTransition:!0,parameters:[{name:"Point1",key:"point1",type:"position",description:"First box point","default":[-1,-1,-1]},{name:"Point2",key:"point2",type:"position",description:"Second box point","default":[1,1,1]},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[{key:"inside",name:"Inside",description:"State to transition to if the entity is inside the box"},{key:"outside",name:"Outside",description:"State to transition to if the entity is outside the box"}]},t.prototype._run=function(e){var t=e.getOwnerEntity(),r=t.transformComponent.worldTransform.translation,i=n(r.data,this.point1,this.point2);i?e.send(this.transitions.inside):e.send(this.transitions.outside)},t}),define("goo/fsmpack/statemachine/actions/CompareDistanceAction",["goo/fsmpack/statemachine/actions/Action","goo/math/Vector3","goo/renderer/Renderer"],function(e,t,n){function r(){e.apply(this,arguments)}return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.external={key:"Compare Distance",name:"Camera Distance",type:"collision",description:"Performs a transition based on the distance to the main camera or to a location",canTransition:!0,parameters:[{name:"Current camera",key:"camera",type:"boolean",description:"Measure the distance to the current camera or to an arbitrary point","default":!0},{name:"Position",key:"position",type:"position",description:"Position to measure the distance to; Will be ignored if previous option is selected","default":[0,0,0]},{name:"Value",key:"value",type:"number",description:"Value to compare to","default":0},{name:"Tolerance",key:"tolerance",type:"number","default":.1},{name:"Type",key:"distanceType",type:"dropdown",description:"The type of distance","default":"Euclidean",options:["Euclidean","Manhattan"]},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[{key:"less",name:"Less",description:"State to transition to if the measured distance is smaller than the specified value"},{key:"equal",name:"Equal",description:"State to transition to if the measured distance is about the same as the specified value"},{key:"greater",name:"Greater",description:"State to transition to if the measured distance is greater than the specified value"}]},r.prototype._run=function(e){var r=e.getOwnerEntity(),i=r.transformComponent.worldTransform.translation,s;this.camera?s=t.sub(i,n.mainCamera.translation):s=t.sub(i,new t(this.position));var o;this.type==="Euclidean"?o=s.length():o=Math.abs(s.x)+Math.abs(s.y)+Math.abs(s.z);var u=this.value-o;Math.abs(u)<=this.tolerance?e.send(this.transitions.equal):u>0?e.send(this.transitions.less):e.send(this.transitions.greater)},r}),define("goo/fsmpack/statemachine/actions/CollidesAction",["goo/fsmpack/statemachine/actions/Action","goo/entities/systems/ProximitySystem","goo/entities/EntityUtils"],function(e,t,n){function r(){e.apply(this,arguments),this.everyFrame=!0}return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.external={key:"Collides",name:"Collision",type:"collision",description:"Checks for collisions with other entities. Collisions are based on the entities' bounding volumes. Before using collisions you first need to tag objects using the 'Tag' action",canTransition:!0,parameters:[{name:"Tag",key:"tag",type:"dropdown",description:"Checks for collisions with other objects having this tag","default":"red",options:["red","blue","green","yellow"]}],transitions:[{key:"collides",name:"On Collision",description:"States to transition to when a collision occurs"},{key:"notCollides",name:"On Divergence",description:"States to transition to when a collision is not occurring"}]},r.prototype.ready=function(e){var n=e.getOwnerEntity(),r=n._world;r.getSystem("ProximitySystem")||r.setSystem(new t)},r.prototype._run=function(e){var t=e.getOwnerEntity(),n=t._world,r=n.getSystem("ProximitySystem"),i=r.getFor(this.tag),s=!1;t.traverse(function(e){var t;if(e.meshRendererComponent){t=e.meshRendererComponent.worldBound;for(var n=0;n<i.length;n++){i[n].traverse(function(e){if(e.meshRendererComponent&&e.meshRendererComponent.worldBound&&t.intersects(e.meshRendererComponent.worldBound))return s=!0,!1});if(s)return!1}}}),s?e.send(this.transitions.collides):e.send(this.transitions.notCollides)},r}),define("goo/fsmpack/statemachine/actions/TagAction",["goo/fsmpack/statemachine/actions/Action","goo/entities/components/ProximityComponent"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.external={name:"Tag",type:"collision",description:"Sets a tag on the entity. Use tags to be able to capture collision events with the 'Collides' action",parameters:[{name:"Tag",key:"tag",type:"dropdown",description:"Checks for collisions with other ojects having this tag","default":"red",options:["red","blue","green","yellow"]}],transitions:[]},n.prototype._run=function(e){var n=e.getOwnerEntity();n.proximityComponent?n.proximityComponent.tag!==this.tag&&(n.clearComponent("ProximityComponent"),n.setComponent(new t(this.tag))):n.setComponent(new t(this.tag))},n.prototype.cleanup=function(e){var t=e.getOwnerEntity();t.clearComponent("ProximityComponent")},n}),define("goo/fsmpack/statemachine/actions/SmokeAction",["goo/fsmpack/statemachine/actions/Action","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/TextureCreator","goo/particles/ParticleLib","goo/util/ParticleSystemUtils"],function(e,t,n,r,i,s){function o(){e.apply(this,arguments),this.smokeEntity=null}return o.material=null,o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.external={key:"Smoke",name:"Smoke FX",type:"fx",description:'Makes the entity emit smoke. To cancel the smoke emitter use the "Remove Particles" action',parameters:[{name:"Color",key:"color",type:"color",description:"Smoke color","default":[0,0,0]}],transitions:[]},o.prototype._run=function(e){var r=e.getOwnerEntity();if(this.smokeEntity&&r.transformComponent.children.indexOf(this.smokeEntity)!==-1)return;var u=r._world.gooRunner;if(!o.material){o.material=new t(n.particles);var a=s.createFlareTexture();a.generateMipmaps=!0,o.material.setTexture("DIFFUSE_MAP",a),o.material.blendState.blending="AlphaBlending",o.material.cullState.enabled=!1,o.material.depthState.write=!1,o.material.renderQueue=2001}var f=r.transformComponent.worldTransform.scale,l=(f.data[0]+f.data[1]+f.data[2])/3;this.smokeEntity=s.createParticleSystemEntity(u.world,i.getSmoke({scale:l,color:this.color}),o.material),this.smokeEntity.meshRendererComponent.isPickable=!1,this.smokeEntity.meshRendererComponent.castShadows=!1,this.smokeEntity.meshRendererComponent.receiveShadows=!1,this.smokeEntity.name="_ParticleSystemSmoke",r.transformComponent.attachChild(this.smokeEntity.transformComponent),this.smokeEntity.addToWorld()},o.prototype.cleanup=function(){this.smokeEntity&&(this.smokeEntity.removeFromWorld(),this.smokeEntity=null)},o}),define("goo/fsmpack/statemachine/actions/FireAction",["goo/fsmpack/statemachine/actions/Action","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/particles/ParticleLib","goo/util/ParticleSystemUtils"],function(e,t,n,r,i){function s(){e.apply(this,arguments),this.fireEntity=null}return s.material=null,s.prototype=Object.create(e.prototype),s.prototype.constructor=s,s.external={key:"Fire",name:"Fire FX",type:"fx",description:'Makes the entity emit fire. To "extinguish" the fire use the "Remove Particles" action',parameters:[{name:"Start Color",key:"startColor",type:"color",description:"Flame color at source","default":[1,1,0]},{name:"End color",key:"endColor",type:"color",description:"Color near the end of a flame's life","default":[1,0,0]}],transitions:[]},s.prototype._run=function(e){var o=e.getOwnerEntity();if(this.fireEntity&&o.transformComponent.children.indexOf(this.fireEntity)!==-1)return;var u=o._world.gooRunner;if(!s.material){s.material=new t(n.particles);var a=i.createFlareTexture();a.generateMipmaps=!0,s.material.setTexture("DIFFUSE_MAP",a),s.material.blendState.blending="AdditiveBlending",s.material.cullState.enabled=!1,s.material.depthState.write=!1,s.material.renderQueue=2002}var f=o.transformComponent.worldTransform.scale,l=(f.data[0]+f.data[1]+f.data[2])/3;this.fireEntity=i.createParticleSystemEntity(u.world,r.getFire({scale:l,startColor:this.startColor,endColor:this.endColor}),s.material),this.fireEntity.meshRendererComponent.isPickable=!1,this.fireEntity.meshRendererComponent.castShadows=!1,this.fireEntity.meshRendererComponent.receiveShadows=!1,this.fireEntity.name="_ParticleSystemFire",o.transformComponent.attachChild(this.fireEntity.transformComponent),this.fireEntity.addToWorld()},s.prototype.cleanup=function(){this.fireEntity&&(this.fireEntity.removeFromWorld(),this.fireEntity=null)},s}),define("goo/fsmpack/statemachine/actions/RemoveParticlesAction",["goo/fsmpack/statemachine/actions/Action","goo/entities/EntityUtils"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.external={name:"Remove Particles",type:"fx",description:"Removes any particle emitter attached to the entity",parameters:[],transitions:[]},n.prototype._run=function(e){var t=e.getOwnerEntity();t.children().each(function(e){e.name.indexOf("_ParticleSystem")!==-1&&e.hasComponent("ParticleComponent")&&e.removeFromWorld()})},n}),define("goo/fsmpack/statemachine/actions/SoundFadeInAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Sound Fade In",type:"sound",description:"Fades in a sound.",canTransition:!0,parameters:[{name:"Sound",key:"sound",type:"sound",description:"Sound","default":0},{name:"Time (ms)",key:"time",type:"number",description:"Time it takes for the fading to complete","default":1e3}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the movement completes"}]},t.prototype._run=function(e){var t=e.getOwnerEntity();if(t.hasComponent("SoundComponent")){var n=t.soundComponent.getSoundById(this.sound);n&&n.fadeIn(this.time/1e3).then(function(){e.send(this.transitions.complete)}.bind(this))}},t}),define("goo/fsmpack/statemachine/actions/SoundFadeOutAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Sound Fade Out",type:"sound",description:"Fades out a sound and stops it.",canTransition:!0,parameters:[{name:"Sound",key:"sound",type:"sound",description:"Sound","default":0},{name:"Time (ms)",key:"time",type:"number",description:"Time it takes for the fading to complete","default":1e3}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the movement completes"}]},t.prototype._run=function(e){var t=e.getOwnerEntity();if(t.hasComponent("SoundComponent")){var n=t.soundComponent.getSoundById(this.sound);n&&n.fadeOut(this.time/1e3).then(function(){e.send(this.transitions.complete)}.bind(this))}},t}),define("goo/fsmpack/statemachine/actions/SetRenderTargetAction",["goo/fsmpack/statemachine/actions/Action","goo/entities/components/PortalComponent","goo/entities/systems/PortalSystem","goo/math/Vector3","goo/entities/components/CameraComponent","goo/renderer/Camera","goo/renderer/Material","goo/renderer/shaders/ShaderLib"],function(e,t,n,r,i,s,o,u){function a(){e.apply(this,arguments)}return a.prototype=Object.create(e.prototype),a.prototype.constructor=a,a.external={name:"Set Render Target",type:"texture",description:"Renders what a camera sees on the current entity's texture",parameters:[{name:"Camera",key:"cameraEntityRef",type:"cameraEntity",description:"Camera to use as source","default":null}],transitions:[]},a.prototype.ready=function(e){var t=e.getOwnerEntity(),r=t._world;if(!r.getSystem("PortalSystem")){var i=r.getSystem("RenderSystem"),s=r.gooRunner.renderer;r.setSystem(new n(s,i))}},a.prototype._run=function(e){var n=e.getOwnerEntity(),r=n._world,i=r.entityManager.getEntityById(this.cameraEntityRef);if(!i||!i.cameraComponent||!i.cameraComponent.camera)return;var s=i.cameraComponent.camera,a=new o(u.textured);if(!n.meshRendererComponent)return;this.oldMaterials=n.meshRendererComponent.materials,n.meshRendererComponent.materials=[a];var f=new t(s,500,{preciseRecursion:!0});n.setComponent(f)},a.prototype.cleanup=function(e){var t=e.getOwnerEntity();this.oldMaterials&&(t.meshRendererComponent.materials=this.oldMaterials),this.oldMaterials=null,t.clearComponent("portalComponent")},a}),define("goo/fsmpack/statemachine/actions/TweenTextureOffsetAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={key:"Tween Texture Offset",name:"Tween Texture",type:"texture",description:"Smoothly changes the texture offset of the entity",canTransition:!0,parameters:[{name:"X Offset",key:"toX",type:"float",control:"slider",min:0,max:1,description:"X Offset","default":1},{name:"Y Offset",key:"toY",type:"float",control:"slider",min:0,max:1,description:"Y Offset","default":1},{name:"Time (ms)",key:"time",type:"number",description:"Time it takes for this transition to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the transition completes"}]},t.prototype.configure=function(e){this.toX=+e.toX,this.toY=+e.toY,this.time=+e.time,e.easing1==="Linear"?this.easing=window.TWEEN.Easing.Linear.None:this.easing=window.TWEEN.Easing[e.easing1][e.easing2],this.eventToEmit={channel:e.transitions.complete}},t.prototype._setup=function(){this.tween=new window.TWEEN.Tween},t.prototype.cleanup=function(){this.tween&&this.tween.stop()},t.prototype._run=function(e){var t=e.getOwnerEntity();if(t.meshRendererComponent&&t.meshRendererComponent.materials.length>0){var n=t.meshRendererComponent,r=n.materials[0],i=r.getTexture("DIFFUSE_MAP");if(!i)return;var s=i.offset,o=t._world.time*1e3,u={x:s.x,y:s.y},a={x:this.toX,y:this.toY};this.tween.from(u).to(a,this.time).easing(this.easing).onUpdate(function(){i.offset.setd(this.x,this.y)}).onComplete(function(){e.send(this.eventToEmit.channel)}.bind(this)).start(o)}},t}),define("goo/fsmpack/statemachine/actions/LogMessageAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Log Message",description:"Prints a message in the debug console of your browser",parameters:[{name:"Message",key:"message",type:"string",description:"Message to print","default":"hello"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},t.prototype._run=function(){console.log(this.message)},t}),define("goo/fsmpack/statemachine/actions/TweenOpacityAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Tween Opacity",type:"texture",description:"Tweens the opacity of a material",parameters:[{name:"Opacity",key:"to",type:"number",description:"Opacity","default":1},{name:"Time (ms)",key:"time",type:"number",description:"Time it takes for the transition to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the transition completes"}]},t.prototype.configure=function(e){this.to=e.to,this.time=e.time,e.easing1==="Linear"?this.easing=window.TWEEN.Easing.Linear.None:this.easing=window.TWEEN.Easing[e.easing1][e.easing2],this.eventToEmit={channel:e.transitions.complete}},t.prototype._setup=function(){this.tween=new window.TWEEN.Tween},t.prototype.cleanup=function(){this.tween&&this.tween.stop()},t.prototype._run=function(e){var t=e.getOwnerEntity();if(t.meshRendererComponent){var n=t.meshRendererComponent,r=n.materials[0],i=r.uniforms,s=t._world.time*1e3,o={opacity:i.opacity===undefined?1:i.opacity},u={opacity:this.to},a={opacity:o.opacity};r.blendState.blending==="NoBlending"&&(r.blendState.blending="CustomBlending"),this.tween.from(o).to(u,+this.time).easing(this.easing).onUpdate(function(){i.opacity+=this.opacity-a.opacity,console.log(i.opacity),a.opacity=this.opacity}).onComplete(function(){e.send(this.eventToEmit.channel)}.bind(this)).start(s)}},t}),define("goo/fsmpack/statemachine/actions/HTMLAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(){this.updated=!0}.bind(this)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"HTMLPick",type:"controls",description:"Listens for a picking event and performs a transition",canTransition:!0,parameters:[],transitions:[{key:"pick",name:"Pick",description:"State to transition to when entity is picked"}]},t.prototype._setup=function(e){var t=e.getOwnerEntity();this.domElement=t.htmlComponent.domElement,this.domElement.addEventListener("click",this.eventListener)},t.prototype._run=function(e){this.updated&&(this.updated=!1,e.send(this.transitions.pick))},t.prototype.exit=function(){this.domElement.removeEventListener("click",this.eventListener)},t}),define("goo/fsmpack/statemachine/actions/CopyJointTransformAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments),this.everyFrame=!0}function n(e){e.updateWorldTransform();var t=e.entity;t&&t.meshDataComponent&&t.meshRendererComponent&&t.meshRendererComponent.updateBounds(t.meshDataComponent.modelBound,e.worldTransform);for(var r=0;r<e.children.length;r++)n(e.children[r])}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Copy Joint Transform",type:"animation",description:"Copies a joints transform, and applies it to this entity. This entity must be a child of an entity with an animation component",parameters:[{name:"Joint",key:"jointIndex",type:"int",control:"jointSelector","default":null}],transitions:[]},t.prototype._run=function(e){if(this.jointIndex===null)return;var t=e.getOwnerEntity(),r=t.transformComponent.parent;if(!r)return;r=r.entity;if(!r.animationComponent||!r.animationComponent._skeletonPose)return;var i=r.animationComponent._skeletonPose,s=i._globalTransforms[this.jointIndex];if(!s)return;t.transformComponent.transform.matrix.copy(s.matrix),n(t.transformComponent)},t}),define("goo/fsmpack/statemachine/actions/Actions",["goo/fsmpack/statemachine/actions/ArrowsAction","goo/fsmpack/statemachine/actions/MouseUpAction","goo/fsmpack/statemachine/actions/MouseDownAction","goo/fsmpack/statemachine/actions/MouseMoveAction","goo/fsmpack/statemachine/actions/KeyUpAction","goo/fsmpack/statemachine/actions/KeyDownAction","goo/fsmpack/statemachine/actions/KeyPressedAction","goo/fsmpack/statemachine/actions/PickAction","goo/fsmpack/statemachine/actions/PickAndExitAction","goo/fsmpack/statemachine/actions/WASDAction","goo/fsmpack/statemachine/actions/MoveAction","goo/fsmpack/statemachine/actions/RotateAction","goo/fsmpack/statemachine/actions/ScaleAction","goo/fsmpack/statemachine/actions/LookAtAction","goo/fsmpack/statemachine/actions/TweenMoveAction","goo/fsmpack/statemachine/actions/TweenRotationAction","goo/fsmpack/statemachine/actions/TweenScaleAction","goo/fsmpack/statemachine/actions/TweenLookAtAction","goo/fsmpack/statemachine/actions/ShakeAction","goo/fsmpack/statemachine/actions/PauseAnimationAction","goo/fsmpack/statemachine/actions/ResumeAnimationAction","goo/fsmpack/statemachine/actions/SetAnimationAction","goo/fsmpack/statemachine/actions/WaitAction","goo/fsmpack/statemachine/actions/TransitionAction","goo/fsmpack/statemachine/actions/RandomTransitionAction","goo/fsmpack/statemachine/actions/EmitAction","goo/fsmpack/statemachine/actions/TransitionOnMessageAction","goo/fsmpack/statemachine/actions/EvalAction","goo/fsmpack/statemachine/actions/HideAction","goo/fsmpack/statemachine/actions/ShowAction","goo/fsmpack/statemachine/actions/RemoveAction","goo/fsmpack/statemachine/actions/AddLightAction","goo/fsmpack/statemachine/actions/RemoveLightAction","goo/fsmpack/statemachine/actions/TweenLightColorAction","goo/fsmpack/statemachine/actions/SetClearColorAction","goo/fsmpack/statemachine/actions/SwitchCameraAction","goo/fsmpack/statemachine/actions/InFrustumAction","goo/fsmpack/statemachine/actions/DollyZoomAction","goo/fsmpack/statemachine/actions/InBoxAction","goo/fsmpack/statemachine/actions/CompareDistanceAction","goo/fsmpack/statemachine/actions/CollidesAction","goo/fsmpack/statemachine/actions/TagAction","goo/fsmpack/statemachine/actions/SmokeAction","goo/fsmpack/statemachine/actions/FireAction","goo/fsmpack/statemachine/actions/RemoveParticlesAction","goo/fsmpack/statemachine/actions/SoundFadeInAction","goo/fsmpack/statemachine/actions/SoundFadeOutAction","goo/fsmpack/statemachine/actions/SetRenderTargetAction","goo/fsmpack/statemachine/actions/TweenTextureOffsetAction","goo/fsmpack/statemachine/actions/LogMessageAction","goo/fsmpack/statemachine/actions/TweenOpacityAction","goo/fsmpack/statemachine/actions/HTMLAction","goo/fsmpack/statemachine/actions/CopyJointTransformAction","goo/fsmpack/statemachine/actions/TweenOpacityAction"],function(){function n(e){var n=0;for(var r=n;r<e.length;r++){var i=e[r];t.register(i.external.key||i.external.name,i)}}var e={},t={};return t.register=function(t,n){e[t]=n},t.actionForType=function(t){return e[t]},t.allActions=function(){var t={},n=Object.keys(e);for(var r=0;r<n.length;r++){var i=n[r];if(i==="Eval")continue;t[i]=e[i]}return t},n(arguments),t}),define("goo/fsmpack/MachineHandler",["goo/loaders/handlers/ConfigHandler","goo/util/PromiseUtil","goo/util/ObjectUtil","goo/fsmpack/statemachine/State","goo/fsmpack/statemachine/Machine","goo/fsmpack/statemachine/actions/Actions","goo/util/rsvp"],function(e,t,n,r,i,s,o){function u(){e.apply(this,arguments)}return u.prototype=Object.create(e.prototype),u.prototype.constructor=u,e._registerClass("machine",u),u.prototype._remove=function(e){var t=this._objects[e];t&&t.removeFromParent(),delete this._objects[e]},u.prototype._create=function(){return new i},u.prototype._update=function(t,n,r){var i=this;return e.prototype._update.call(this,t,n,r).then(function(e){if(!e)return;e.name=n.name;for(var t in e._states)n.states[t]||e.removeState(t);var s=[];for(var t in n.states)s.push(i._updateState(e,n.states[t],r));return o.all(s).then(function(){return e.setInitialState(n.initialState),e})})},u.prototype._updateActions=function(e,t){for(var r=0;r<e._actions.length;r++){var i=e._actions[r];t.actions[i.id]||(e.removeAction(i),r--)}var o=[];n.forEach(t.actions,function(t){var n=e.getAction(t.id);if(!n){var r=s.actionForType(t.type);n=new r(t.id,t.options),n.onCreate&&n.onCreate(e.proxy)}else n.configure(t.options);o.push(n)},null,"sortValue"),e._actions=o},u.prototype._updateTransitions=function(e,t){e._transitions={};for(var n in t.transitions){var r=t.transitions[n];e.setTransition(r.id,r.targetState)}},u.prototype._updateState=function(e,t,n){var i;e._states&&e._states[t.id]?i=e._states[t.id]:(i=new r(t.id),e.addState(i)),i.name=t.name,this._updateActions(i,t),this._updateTransitions(i,t);for(var s=0;s<i._machines;s++){var u=i._machines[s];t.childMachines[u.id]||(i.removeMachine(u),s--)}var a=[];for(var f in t.childMachines)a.push(this._load(t.childMachines[f].machineRef,n));return o.all(a).then(function(e){for(var t=0;t<e;t++)i.addMachine(e[t]);return i})},u}),define("goo/fsmpack/statemachine/StateMachineComponent",["goo/entities/components/Component","goo/util/ArrayUtil","goo/entities/SystemBus"],function(e,t,n){function r(){this.type="StateMachineComponent",this._machines=[],this.entity=null,this.vars={},this.system=null,this.time=0,this.active=!0}return r.prototype=Object.create(e.prototype),r.vars={},r.getVariable=function(e){return r.vars[e]},r.prototype.getVariable=function(e){return this.vars[e]!==undefined?this.vars[e]:r.getVariable(e)},r.applyOnVariable=function(e,t){r.vars[e]=t(r.vars[e])},r.prototype.applyOnVariable=function(e,t){this.vars[e]!==undefined?this.vars[e]=t(this.vars[e]):r.applyOnVariable(e,t)},r.prototype.defineVariable=function(e,t){this.vars[e]=t},r.prototype.removeVariable=function(e){delete this.vars[e]},r.applyOnVariable=function(e,t){this.vars[e]?this.vars[e]=t(this.vars[e]):r.vars[e]&&r.applyOnVariable(e,t)},r.prototype.addMachine=function(e){e._fsm=this,e.parent=this,this._machines.push(e)},r.prototype.removeMachine=function(e){e.recursiveRemove(),t.remove(this._machines,e)},r.prototype.init=function(){for(var e=0;e<this._machines.length;e++){var t=this._machines[e];t.setRefs(this),t.reset(),t.ready()}},r.prototype.doEnter=function(){for(var e=0;e<this._machines.length;e++){var t=this._machines[e];t.enter()}},r.prototype.kill=function(){for(var e=0;e<this._machines.length;e++){var t=this._machines[e];t.kill()}},r.prototype.cleanup=function(){for(var e=0;e<this._machines.length;e++){var t=this._machines[e];t.cleanup()}},r.prototype.update=function(){if(this.active)for(var e=0;e<this._machines.length;e++){var t=this._machines[e];t.update()}},r.prototype.pause=function(){this.active=!1,n.emit("goo.entity."+this.entity.name+".fsm.pause")},r.prototype.play=function(){this.active=!0,n.emit("goo.entity."+this.entity.name+".fsm.play")},r}),define("goo/fsmpack/StateMachineComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/fsmpack/statemachine/StateMachineComponent","goo/util/rsvp"],function(e,t,n){function r(){e.apply(this,arguments),this._type="StateMachineComponent"}return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,e._registerClass("stateMachine",r),r.prototype._create=function(){return new t},r.prototype.update=function(t,r,i){var s=this;return e.prototype.update.call(this,t,r,i).then(function(e){if(!e)return;var t=[];for(var o in r.machines)t.push(s._load(r.machines[o].machineRef,i));return n.all(t).then(function(t){for(var n=0;n<t.length;n++)e._machines.indexOf(t[n])===-1&&e.addMachine(t[n]);for(var n=0;n<e._machines.length;n++)t.indexOf(e._machines[n])===-1&&e.removeMachine(e._machines[n]);return e})})},r}),define("goo/fsmpack/statemachine/StateMachineSystem",["goo/entities/systems/System","goo/fsmpack/statemachine/actions/Actions"],function(e){function t(t){e.call(this,"StateMachineSystem",["StateMachineComponent"]),this.engine=t,this.resetRequest=!1,this.passive=!1,this.entered=!0,this.paused=!1,this.time=0,this.evalProxy={test:function(){console.log("test")}},this.priority=1e3}return t.prototype=Object.create(e.prototype),t.prototype.process=function(e,t){var n;if(this.resetRequest){this.resetRequest=!1;for(var r=0;r<e.length;r++)n=e[r].stateMachineComponent,n.kill(),n.cleanup();this.time=0,window.TWEEN&&window.TWEEN.removeAll(),this.passive=!0;return}this.time+=t;if(this.entered){this.entered=!1;for(var r=0;r<e.length;r++)n=e[r].stateMachineComponent,n.init(),n.doEnter()}window.TWEEN&&window.TWEEN.update(this.engine.world.time*1e3);for(var r=0;r<e.length;r++)n=e[r].stateMachineComponent,n.update(t)},t.prototype.inserted=function(e){var t=e.stateMachineComponent;t.entity=e,t.system=this,t.init()},t.prototype.pause=function(){this.passive=!0,this.paused=!0},t.prototype.play=function(){this.passive=!1,this.paused||(this.entered=!0),this.paused=!1},t.prototype.reset=function(){this.passive=!1,this.resetRequest=!0,this.paused=!1},t}),define("goo/fsmpack/statemachine/actions/AddPositionAction",["goo/fsmpack/statemachine/actions/Action","goo/fsmpack/statemachine/FSMUtil"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.configure=function(e){this.everyFrame=e.everyFrame!==!1,this.entity=e.entity||null,this.amountX=e.amountX||0,this.amountY=e.amountY||0,this.amountZ=e.amountZ||0,this.speed=e.speed||1},n.external={parameters:[{name:"Entity",key:"entity",type:"entity",description:"Entity to move"},{name:"Amount X",key:"amountX",type:"float",description:"Amount to move on the X axis","default":0},{name:"Amount Y",key:"amountY",type:"float",description:"Amount to move on the Y axis","default":0},{name:"Amount Z",key:"amountZ",type:"float",description:"Amount to move on the Z axis","default":0},{name:"Speed",key:"speed",type:"float",description:"Speed to multiply","default":1},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},n.prototype._run=function(e){if(this.entity!==null){var n=e.getTpf(),r=t.getValue(this.amountX,e),i=t.getValue(this.amountY,e),s=t.getValue(this.amountZ,e);this.entity.transformComponent.transform.translation.add_d(r*this.speed*n,i*this.speed*n,s*this.speed*n),this.entity.transformComponent.setUpdated()}},n}),define("goo/fsmpack/statemachine/actions/AddVariableAction",["goo/fsmpack/statemachine/actions/Action","goo/fsmpack/statemachine/FSMUtil"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.configure=function(e){this.everyFrame=!!e.everyFrame,this.variable=e.variable||null,this.amount=e.amount||1},n.external={parameters:[{name:"Variable",key:"variable",type:"identifier"},{name:"Amount",key:"amount",type:"float"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},n.prototype._run=function(e){e.applyOnVariable(this.variable,function(n){return n+t.getValue(this.amount,e)}.bind(this))},n}),define("goo/fsmpack/statemachine/actions/GetPositionAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.configure=function(e){this.everyFrame=e.everyFrame!==!1,this.entity=e.entity||null,this.variableX=e.variableX||null,this.variableY=e.variableY||null,this.variableZ=e.variableZ||null},t.external={parameters:[{name:"VariableX",key:"variableX",type:"identifier"},{name:"VariableY",key:"variableY",type:"identifier"},{name:"VariableZ",key:"variableZ",type:"identifier"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},t.prototype._run=function(e){var t=this.entity.transformComponent.transform.translation;this.entity!==null&&(this.variableX&&e.applyOnVariable(this.variableX,function(){return t.data[0]}),this.variableY&&e.applyOnVariable(this.variableY,function(){return t.data[1]}),this.variableZ&&e.applyOnVariable(this.variableZ,function(){return t.data[2]}))},t}),define("goo/fsmpack/statemachine/actions/GuiButtonAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(e){e=e||{},this.everyFrame=e.everyFrame||!0,this.name=e.name||"Button",this.event=e.event||"dummy"}return t.prototype=Object.create(e.prototype),t.external=[{name:"Name",key:"name",type:"string"},{name:"Send Event",key:"event",type:"event"}],t.prototype._setup=function(e){this.button=$("<button/>",{text:this.name,css:{position:"relative","z-index":1e4},click:function(){e.send(this.event)}.bind(this)}).appendTo($("body"))},t.prototype.exit=function(){this.button&&this.button.remove()},t}),define("goo/fsmpack/statemachine/actions/MultiplyVariableAction",["goo/fsmpack/statemachine/actions/Action","goo/fsmpack/statemachine/FSMUtil"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.configure=function(e){this.everyFrame=!!e.everyFrame,this.variable=e.variable||null,this.amount=e.amount||1},n.external={parameters:[{name:"Variable",key:"variable",type:"identifier"},{name:"Amount",key:"amount",type:"float"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},n.prototype._run=function(e){e.applyOnVariable(this.variable,function(n){return n*t.getValue(this.amount,e)}.bind(this))},n}),define("goo/fsmpack/statemachine/actions/NumberCompareAction",["goo/fsmpack/statemachine/actions/Action","goo/fsmpack/statemachine/FSMUtil"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.configure=function(e){this.everyFrame=e.everyFrame!==!1,this.leftHand=e.leftHand||0,this.rightHand=e.rightHand||0,this.tolerance=e.tolerance||1e-4,this.lessThanEvent={channel:e.transitions.less},this.equalEvent={channel:e.transitions.equal},this.greaterThanEvent={channel:e.transitions.greater}},n.external={parameters:[{name:"Left hand value",key:"leftHand",type:"float"},{name:"Right hand value",key:"rightHand",type:"float"},{name:"Tolerance",key:"tolerance",type:"float","default":.001},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[{name:"less",description:"Event fired if left hand argument is smaller than right hand argument"},{name:"equal",description:"Event fired if both sides are approximately equal"},{name:"greater",description:"Event fired if left hand argument is greater than right hand argument"}]},n.prototype._run=function(e){var n=t.getValue(this.leftHand,e),r=t.getValue(this.rightHand,e),i=r-n;Math.abs(i)<=this.tolerance?this.equalEvent.channel&&e.send(this.equalEvent.channel):i>0?this.lessThanEvent.channel&&e.send(this.lessThanEvent.channel):this.greaterThanEvent.channel&&e.send(this.greaterThanEvent.channel)},n}),define("goo/fsmpack/statemachine/actions/ResumeFSMAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Resume FSM",description:"Continue running a suspended state machine",parameters:[{name:"Entity",key:"entity",type:"entity",description:"Entity to resume its FSM","default":null}],transitions:[]},t.prototype._run=function(){this.entity&&this.entity.stateMachineComponent&&this.entity.stateMachineComponent.resume()},t}),define("goo/fsmpack/statemachine/actions/SetCssPropertyAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(e){e=e||{},this.everyFrame=e.everyFrame||!1,this.selector=e.selector||"body",this.property=e.property||"background-color",this.value=e.value||"black"}return t.prototype=Object.create(e.prototype),t.external=[{selector:["string","Selector"],property:["string","Property"],value:["string","Value"]}],t.prototype.onCreate=function(){$(this.selector).css(this.property,this.value)},t}),define("goo/fsmpack/statemachine/actions/SetLightRangeAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.configure=function(e){this.everyFrame=!!e.everyFrame,this.entity=e.entity||null,this.range=e.range||100},t.external={name:"Set Light Range",description:"Sets the range of a light",parameters:[{name:"Entity",key:"entity",type:"entity",description:"Light entity"},{name:"Range",key:"range",type:"real",description:"Light range","default":100,min:0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},t.prototype._run=function(){this.entity&&this.entity.lightComponent&&this.entity.lightComponent.light&&(this.entity.lightComponent.light.range=this.range)},t}),define("goo/fsmpack/statemachine/actions/SetPositionAction",["goo/fsmpack/statemachine/actions/Action","goo/fsmpack/statemachine/FSMUtil"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.configure=function(e){this.everyFrame=!!e.everyFrame,this.entity=e.entity||null,this.amountX=e.amountX||0,this.amountY=e.amountY||0,this.amountZ=e.amountZ||0},n.external={parameters:[{name:"Entity",key:"entity",type:"entity",description:"Entity to move"},{name:"Amount X",key:"amountX",type:"float",description:"Position on the X axis","default":0},{name:"Amount Y",key:"amountY",type:"float",description:"Position on the Y axis","default":0},{name:"Amount Z",key:"amountZ",type:"float",description:"Position on the Z axis","default":0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},n.prototype._run=function(e){this.entity!==null&&(this.entity.transformComponent.transform.translation.setd(t.getValue(this.amountX,e),t.getValue(this.amountY,e),t.getValue(this.amountZ,e)),this.entity.transformComponent.setUpdated())},n}),define("goo/fsmpack/statemachine/actions/SetRotationAction",["goo/fsmpack/statemachine/actions/Action","goo/fsmpack/statemachine/FSMUtil"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.configure=function(e){this.everyFrame=!!e.everyFrame,this.entity=e.entity||null,this.amountX=e.amountX||0,this.amountY=e.amountY||0,this.amountZ=e.amountZ||0},n.external={parameters:[{name:"Entity",key:"entity",type:"entity",description:"Entity to move"},{name:"Amount X",key:"amountX",type:"float",description:"Amount to rotate on the X axis","default":0},{name:"Amount Y",key:"amountY",type:"float",description:"Amount to rotate on the Y axis","default":0},{name:"Amount Z",key:"amountZ",type:"float",description:"Amount to rotate on the Z axis","default":0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},n.prototype._run=function(e){this.entity!==null&&(this.entity.transformComponent.transform.setRotationXYZ(t.getValue(this.amountX,e),t.getValue(this.amountY,e),t.getValue(this.amountZ,e)),this.entity.transformComponent.setUpdated())},n}),define("goo/fsmpack/statemachine/actions/SetVariableAction",["goo/fsmpack/statemachine/actions/Action","goo/fsmpack/statemachine/FSMUtil"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.configure=function(e){this.everyFrame=e.everyFrame!==!1,this.variable=e.variable||null,this.amount=e.amount||0},n.external={parameters:[{name:"Variable",key:"variable",type:"identifier"},{name:"Amount",key:"amount",type:"float"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},n.prototype._run=function(e){this.variable&&e.applyOnVariable(this.variable,function(){return t.getValue(this.amount,e)}.bind(this))},n}),define("goo/fsmpack/statemachine/actions/SnowAction",["goo/fsmpack/statemachine/actions/Action","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/TextureCreator","goo/particles/ParticleLib","goo/util/ParticleSystemUtils"],function(e,t,n,r,i,s){function o(){e.apply(this,arguments)}return o.material=null,o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.external={name:"Snow",description:"Makes the entity emit snow",parameters:[],transitions:[]},o.prototype._run=function(e){var r=e.getOwnerEntity(),u=r._world.gooRunner;if(!o.material){o.material=new t(n.particles);var a=s.createFlareTexture();a.generateMipmaps=!0,o.material.setTexture("DIFFUSE_MAP",a),o.material.blendState.blending="AlphaBlending",o.material.cullState.enabled=!1,o.material.depthState.write=!1,o.material.renderQueue=2001}var f=s.createParticleSystemEntity(u.world,i.getSmoke(),o.material);f.name="_ParticleSystemSnow",r.transformComponent.attachChild(f.transformComponent),f.addToWorld()},o}),define("goo/fsmpack/statemachine/actions/SuspendFSMAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.external={name:"Suspend FSM",description:"Suspends the state machine of another entity",parameters:[{name:"Entity",key:"entity",type:"entity",description:"Entity to suspend its FSM","default":null}],transitions:[]},t.prototype._run=function(){this.entity&&this.entity.stateMachineComponent&&this.entity.stateMachineComponent.pause()},t}),define("goo/fsmpack/statemachine/actions/TestAngleAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(e){e=e||{},this.everyFrame=e.everyFrame||!0,this.entity=e.entity||null,this.rangeMin=e.rangeMin||0,this.rangeMax=e.rangeMax||Math.PI,this.eventInRange=e.eventInRange||"inRange",this.eventOutRange=e.eventOutRange||"outRange"}return t.prototype=Object.create(e.prototype),t.external=[{name:"Entity",key:"entity",type:"entity"},{name:"RangeMin",key:"rangeMin",type:"spinner"},{name:"RangeMax",key:"rangeMax",type:"spinner"},{name:"Event In Range",key:"eventInRange",type:"event"},{name:"Event Out Of Range",key:"eventOutRange",type:"event"}],t.prototype.onUpdate=function(e){if(this.entity!==null&&this.entity.body){var t=this.entity.body.GetAngle()%(Math.PI*2);t<0&&(t=Math.PI*2+t),t>=this.rangeMin&&t<=this.rangeMax?e.handle(this.eventInRange):e.handle(this.eventOutRange)}},t}),define("goo/fsmpack/statemachine/actions/TestSpeedAction",["goo/fsmpack/statemachine/actions/Action"],function(e){function t(e){this.type="TestSpeedAction",this.everyFrame=e.everyFrame||!0,e=e||{},this.entity=e.entity||null,this.rangeMin=e.rangeMin||0,this.rangeMax=e.rangeMax||Math.PI,this.eventInRange=e.eventInRange||"inRange",this.eventOutRange=e.eventOutRange||"outRange"}return t.prototype=Object.create(e.prototype),t.external=[{name:"Entity",key:"entity",type:"entity"},{name:"RangeMin",key:"rangeMin",type:"spinner"},{name:"RangeMax",key:"rangeMax",type:"spinner"},{name:"Event In Range",key:"eventInRange",type:"event"},{name:"Event Out Of Range",key:"eventOutRange",type:"event"}],t.prototype.onUpdate=function(e){if(this.entity!==null&&this.entity.body){var t=this.entity.body.GetLinearVelocity().Length();t>=this.rangeMin&&t<=this.rangeMax?e.handle(this.eventInRange):e.handle(this.eventOutRange)}},t}),define("goo/fsmpack/statemachine/actions/TweenAction",["goo/fsmpack/statemachine/actions/Action","goo/fsmpack/statemachine/FSMUtil"],function(Action,FSMUtil){function TweenAction(){Action.apply(this,arguments)}return TweenAction.prototype=Object.create(Action.prototype),TweenAction.prototype.constructor=TweenAction,TweenAction.external={name:"Tween",description:"Tween anything",canTransition:!0,parameters:[{name:"To",key:"to",type:"number",description:"Value to tween to","default":0},{name:"Object",key:"objectName",type:"string",description:"Object","default":""},{name:"Property",key:"propertyName",type:"string",description:"Property","default":""},{name:"Time (ms)",key:"time",type:"number",description:"Time it takes for this tween to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the tween completes"}]},TweenAction.prototype.configure=function(e){this.to=e.to,this.objectName=e.objectName,this.propertyName=e.propertyName,this.time=e.time,e.easing1==="Linear"?this.easing=window.TWEEN.Easing.Linear.None:this.easing=window.TWEEN.Easing[e.easing1][e.easing2],this.eventToEmit={channel:e.transitions.complete}},TweenAction.prototype._run=function(fsm){var entity=fsm.getOwnerEntity(),object=eval("entity."+this.objectName),from=object[this.propertyName];FSMUtil.createComposableTween(entity,this.propertyName,from,this.to,this.time)},TweenAction}),require(["goo/fsmpack/MachineHandler","goo/fsmpack/StateMachineComponentHandler","goo/fsmpack/statemachine/FSMUtil","goo/fsmpack/statemachine/Machine","goo/fsmpack/statemachine/State","goo/fsmpack/statemachine/StateMachineComponent","goo/fsmpack/statemachine/StateMachineSystem","goo/fsmpack/statemachine/actions/Action","goo/fsmpack/statemachine/actions/Actions","goo/fsmpack/statemachine/actions/AddLightAction","goo/fsmpack/statemachine/actions/AddPositionAction","goo/fsmpack/statemachine/actions/AddVariableAction","goo/fsmpack/statemachine/actions/ArrowsAction","goo/fsmpack/statemachine/actions/CollidesAction","goo/fsmpack/statemachine/actions/CompareDistanceAction","goo/fsmpack/statemachine/actions/CopyJointTransformAction","goo/fsmpack/statemachine/actions/DollyZoomAction","goo/fsmpack/statemachine/actions/EmitAction","goo/fsmpack/statemachine/actions/EvalAction","goo/fsmpack/statemachine/actions/FireAction","goo/fsmpack/statemachine/actions/GetPositionAction","goo/fsmpack/statemachine/actions/GuiButtonAction","goo/fsmpack/statemachine/actions/HTMLAction","goo/fsmpack/statemachine/actions/HideAction","goo/fsmpack/statemachine/actions/InBoxAction","goo/fsmpack/statemachine/actions/InFrustumAction","goo/fsmpack/statemachine/actions/KeyDownAction","goo/fsmpack/statemachine/actions/KeyPressedAction","goo/fsmpack/statemachine/actions/KeyUpAction","goo/fsmpack/statemachine/actions/LogMessageAction","goo/fsmpack/statemachine/actions/LookAtAction","goo/fsmpack/statemachine/actions/MouseDownAction","goo/fsmpack/statemachine/actions/MouseMoveAction","goo/fsmpack/statemachine/actions/MouseUpAction","goo/fsmpack/statemachine/actions/MoveAction","goo/fsmpack/statemachine/actions/MultiplyVariableAction","goo/fsmpack/statemachine/actions/NumberCompareAction","goo/fsmpack/statemachine/actions/PauseAnimationAction","goo/fsmpack/statemachine/actions/PickAction","goo/fsmpack/statemachine/actions/PickAndExitAction","goo/fsmpack/statemachine/actions/RandomTransitionAction","goo/fsmpack/statemachine/actions/RemoveAction","goo/fsmpack/statemachine/actions/RemoveLightAction","goo/fsmpack/statemachine/actions/RemoveParticlesAction","goo/fsmpack/statemachine/actions/ResumeAnimationAction","goo/fsmpack/statemachine/actions/ResumeFSMAction","goo/fsmpack/statemachine/actions/RotateAction","goo/fsmpack/statemachine/actions/ScaleAction","goo/fsmpack/statemachine/actions/SetAnimationAction","goo/fsmpack/statemachine/actions/SetClearColorAction","goo/fsmpack/statemachine/actions/SetCssPropertyAction","goo/fsmpack/statemachine/actions/SetLightRangeAction","goo/fsmpack/statemachine/actions/SetPositionAction","goo/fsmpack/statemachine/actions/SetRenderTargetAction","goo/fsmpack/statemachine/actions/SetRotationAction","goo/fsmpack/statemachine/actions/SetVariableAction","goo/fsmpack/statemachine/actions/ShakeAction","goo/fsmpack/statemachine/actions/ShowAction","goo/fsmpack/statemachine/actions/SmokeAction","goo/fsmpack/statemachine/actions/SnowAction","goo/fsmpack/statemachine/actions/SoundFadeInAction","goo/fsmpack/statemachine/actions/SoundFadeOutAction","goo/fsmpack/statemachine/actions/SuspendFSMAction","goo/fsmpack/statemachine/actions/SwitchCameraAction","goo/fsmpack/statemachine/actions/TagAction","goo/fsmpack/statemachine/actions/TestAngleAction","goo/fsmpack/statemachine/actions/TestSpeedAction","goo/fsmpack/statemachine/actions/TransitionAction","goo/fsmpack/statemachine/actions/TransitionOnMessageAction","goo/fsmpack/statemachine/actions/TweenAction","goo/fsmpack/statemachine/actions/TweenLightColorAction","goo/fsmpack/statemachine/actions/TweenLookAtAction","goo/fsmpack/statemachine/actions/TweenMoveAction","goo/fsmpack/statemachine/actions/TweenOpacityAction","goo/fsmpack/statemachine/actions/TweenRotationAction","goo/fsmpack/statemachine/actions/TweenScaleAction","goo/fsmpack/statemachine/actions/TweenTextureOffsetAction","goo/fsmpack/statemachine/actions/WASDAction","goo/fsmpack/statemachine/actions/WaitAction"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt,yt,bt,wt,Et,St,xt,Tt){var Nt=window.goo;if(!Nt)return;Nt.MachineHandler=e,Nt.StateMachineComponentHandler=t,Nt.FSMUtil=n,Nt.Machine=r,Nt.State=i,Nt.StateMachineComponent=s,Nt.StateMachineSystem=o,Nt.Action=u,Nt.Actions=a,Nt.AddLightAction=f,Nt.AddPositionAction=l,Nt.AddVariableAction=c,Nt.ArrowsAction=h,Nt.CollidesAction=p,Nt.CompareDistanceAction=d,Nt.CopyJointTransformAction=v,Nt.DollyZoomAction=m,Nt.EmitAction=g,Nt.EvalAction=y,Nt.FireAction=b,Nt.GetPositionAction=w,Nt.GuiButtonAction=E,Nt.HTMLAction=S,Nt.HideAction=x,Nt.InBoxAction=T,Nt.InFrustumAction=N,Nt.KeyDownAction=C,Nt.KeyPressedAction=k,Nt.KeyUpAction=L,Nt.LogMessageAction=A,Nt.LookAtAction=O,Nt.MouseDownAction=M,Nt.MouseMoveAction=_,Nt.MouseUpAction=D,Nt.MoveAction=P,Nt.MultiplyVariableAction=H,Nt.NumberCompareAction=B,Nt.PauseAnimationAction=j,Nt.PickAction=F,Nt.PickAndExitAction=I,Nt.RandomTransitionAction=q,Nt.RemoveAction=R,Nt.RemoveLightAction=U,Nt.RemoveParticlesAction=z,Nt.ResumeAnimationAction=W,Nt.ResumeFSMAction=X,Nt.RotateAction=V,Nt.ScaleAction=$,Nt.SetAnimationAction=J,Nt.SetClearColorAction=K,Nt.SetCssPropertyAction=Q,Nt.SetLightRangeAction=G,Nt.SetPositionAction=Y,Nt.SetRenderTargetAction=Z,Nt.SetRotationAction=et,Nt.SetVariableAction=tt,Nt.ShakeAction=nt,Nt.ShowAction=rt,Nt.SmokeAction=it,Nt.SnowAction=st,Nt.SoundFadeInAction=ot,Nt.SoundFadeOutAction=ut,Nt.SuspendFSMAction=at,Nt.SwitchCameraAction=ft,Nt.TagAction=lt,Nt.TestAngleAction=ct,Nt.TestSpeedAction=ht,Nt.TransitionAction=pt,Nt.TransitionOnMessageAction=dt,Nt.TweenAction=vt,Nt.TweenLightColorAction=mt,Nt.TweenLookAtAction=gt,Nt.TweenMoveAction=yt,Nt.TweenOpacityAction=bt,Nt.TweenRotationAction=wt,Nt.TweenScaleAction=Et,Nt.TweenTextureOffsetAction=St,Nt.WASDAction=xt,Nt.WaitAction=Tt}),define("goo/fsmpack/fsmpack",function(){});
}try{
if(window.localStorage&&window.localStorage.gooPath){
window.require.config({
paths:{goo:localStorage.gooPath}
});
}else f()
}catch(e){f()}
})(window,undefined)